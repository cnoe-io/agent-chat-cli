# Agent-Chat-CLI Development Rules

## Repository Information

**Project**: Agent-Chat-CLI
**Type**: Python CLI Tool for A2A Agent Communication
**Language**: Python 3.11+
**Package Manager**: uv
**Testing**: pytest

## Git Commit Standards

### Conventional Commits (REQUIRED)

All commits MUST follow the [Conventional Commits](https://www.conventionalcommits.org/) specification:

```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

#### Commit Types

- **feat**: A new feature
  ```
  feat: add dynamic form support for structured metadata
  feat(a2a): implement streaming display modes
  ```

- **fix**: A bug fix
  ```
  fix: handle null field values in metadata forms
  fix(streaming): prevent raw JSON display during streaming
  ```

- **docs**: Documentation only changes
  ```
  docs: add ADR for display modes
  docs(adr): update streaming behavior documentation
  ```

- **style**: Changes that don't affect code meaning (formatting, missing semi-colons, etc.)
  ```
  style: format code with black
  ```

- **refactor**: Code change that neither fixes a bug nor adds a feature
  ```
  refactor: simplify metadata parsing logic
  ```

- **perf**: Performance improvements
  ```
  perf: optimize line clearing calculation
  ```

- **test**: Adding missing tests or correcting existing tests
  ```
  test: add tests for null value handling
  ```

- **build**: Changes to build system or dependencies
  ```
  build: update rich library to v13.7.0
  ```

- **ci**: Changes to CI configuration files and scripts
  ```
  ci: add GitHub Actions workflow for tests
  ```

- **chore**: Other changes that don't modify src or test files
  ```
  chore: update .gitignore
  ```

#### Breaking Changes

Breaking changes MUST be indicated with `!` after the type/scope:

```
feat!: remove legacy SLIM protocol support

BREAKING CHANGE: The SLIM protocol client has been removed.
Use the A2A protocol instead.
```

### Developer Certificate of Origin (DCO) - REQUIRED

Every commit MUST include a DCO sign-off:

```
Signed-off-by: Your Name <your.email@example.com>
```

#### How to Sign Off

**Option 1: Command Line (Recommended)**
```bash
git commit -s -m "feat: add new feature"
```

**Option 2: Manually add to commit message**
```bash
git commit -m "feat: add new feature

Signed-off-by: Sri Aradhyula <sraradhy@cisco.com>"
```

**Option 3: Configure Git to always sign off**
```bash
git config --global format.signoff true
```

#### DCO Meaning

By signing off, you certify that:
- You wrote the code or have the right to submit it
- You understand the code will be distributed under the project's license
- You agree to the Developer Certificate of Origin v1.1

### Complete Commit Example

```
feat(forms): add dynamic form support for structured metadata

Implemented parse_structured_response() and render_metadata_form()
to enable interactive CLI forms with dropdown and text field support.

Users can now interact with structured agent responses through
beautiful Rich-based prompts instead of manually typing JSON.

Closes #123

Signed-off-by: Sri Aradhyula <sraradhy@cisco.com>
```

## Architecture Decision Records (ADRs)

### Location

**ALL ADRs MUST be created in**: `docs/docs/changes/`

```
agent-chat-cli/
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îî‚îÄ‚îÄ docs/
‚îÇ       ‚îî‚îÄ‚îÄ changes/         ‚Üê ADRs go here
‚îÇ           ‚îú‚îÄ‚îÄ .cursorrules
‚îÇ           ‚îú‚îÄ‚îÄ README.md
‚îÇ           ‚îî‚îÄ‚îÄ YYYY-MM-DD-title.md
```

### Creating ADRs

When implementing significant changes:

1. **Create ADR file** in `docs/docs/changes/`
2. **Follow naming**: `YYYY-MM-DD-descriptive-title.md`
3. **Use ADR template** from `.cursorrules` in that directory
4. **Verify status**: Only mark üü¢ In-use if feature is implemented and tested
5. **Update README**: Add entry to `docs/docs/changes/README.md`

### What Requires an ADR

‚úÖ Create ADR for:
- New features (interactive forms, display modes)
- Architecture changes (streaming behavior, state management)
- Bug fixes with broad impact
- Configuration changes
- Protocol changes

‚ùå Don't create ADR for:
- Minor bug fixes
- Typo corrections
- Dependency updates
- Code formatting

## Code Style

### Python Code Standards

- **Formatter**: Black (line length 100)
- **Linter**: Ruff
- **Type Hints**: Required for all functions
- **Docstrings**: Required for public functions (Google style)

```python
def parse_structured_response(text: str) -> dict:
    """Parse structured JSON responses from agents.

    Args:
        text: Raw response text from agent

    Returns:
        Dictionary with content, require_user_input, and metadata

    Example:
        >>> parse_structured_response('{"content": "Hello"}')
        {'content': 'Hello', 'require_user_input': False, 'metadata': None}
    """
    # Implementation
```

### Import Organization

```python
# Standard library
import os
import sys
from typing import Optional, Dict, Any

# Third-party
from rich.console import Console
from rich.panel import Panel
import httpx

# Local
from agent_chat_cli.chat_interface import render_answer
from agent_chat_cli.a2a_client import A2AClient
```

### Testing Requirements

- **Coverage**: Minimum 80% for new code
- **Test Files**: Match source file structure
  - `agent_chat_cli/a2a_client.py` ‚Üí `tests/test_a2a_client.py`
- **Integration Tests**: Required for CLI commands

```bash
# Run tests
pytest tests/

# With coverage
pytest --cov=agent_chat_cli tests/

# Specific test
pytest tests/test_chat_interface.py -k test_parse_json_response
```

## Development Workflow

### 1. Create Feature Branch

```bash
git checkout -b feat/dynamic-forms
# or
git checkout -b fix/null-field-handling
```

### 2. Make Changes

- Write code following style guidelines
- Add/update tests
- Create/update ADR in `docs/docs/changes/` if needed

### 3. Run Tests

```bash
# Format code
black agent_chat_cli/ tests/

# Lint
ruff check agent_chat_cli/ tests/

# Test
pytest tests/ --cov=agent_chat_cli
```

### 4. Commit with DCO

```bash
git add .
git commit -s -m "feat(forms): add dynamic form support

Implemented interactive CLI forms with dropdown and text field support.

Signed-off-by: Sri Aradhyula <sraradhy@cisco.com>"
```

### 5. Push and Create PR

```bash
git push origin feat/dynamic-forms
```

## File Organization

```
agent-chat-cli/
‚îú‚îÄ‚îÄ agent_chat_cli/          # Source code
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ __main__.py
‚îÇ   ‚îú‚îÄ‚îÄ a2a_client.py        # A2A protocol client
‚îÇ   ‚îú‚îÄ‚îÄ chat_interface.py    # UI/rendering
‚îÇ   ‚îî‚îÄ‚îÄ enhanced_input.py    # Input handling
‚îú‚îÄ‚îÄ tests/                   # Test files
‚îÇ   ‚îú‚îÄ‚îÄ test_a2a_client.py
‚îÇ   ‚îú‚îÄ‚îÄ test_chat_interface.py
‚îÇ   ‚îî‚îÄ‚îÄ integration/         # Integration tests
‚îú‚îÄ‚îÄ docs/                    # Documentation
‚îÇ   ‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ changes/         # ‚Üê ADRs HERE
‚îÇ   ‚îî‚îÄ‚îÄ ENHANCED_INPUT_GUIDE.md
‚îú‚îÄ‚îÄ examples/                # Example scripts
‚îú‚îÄ‚îÄ pyproject.toml          # Project config
‚îú‚îÄ‚îÄ uv.lock                 # Dependency lock
‚îî‚îÄ‚îÄ README.md
```

## Environment Variables

Document all environment variables in ADRs:

```bash
# A2A Agent Connection
A2A_HOST=localhost           # Agent host
A2A_PORT=8000               # Agent port
A2A_TLS=false               # Enable TLS
A2A_TOKEN=                  # Auth token (optional)

# Display Configuration
A2A_SHOW_STREAMING=true     # Show real-time streaming
A2A_CLEAR_STREAMING=true    # Clear streaming before panel

# Debugging
A2A_DEBUG_CLIENT=false      # Enable debug logging
```

## Code Review Checklist

Before submitting PR:
- [ ] Conventional commit format used
- [ ] DCO sign-off present (`Signed-off-by:`)
- [ ] Tests added/updated
- [ ] Tests passing locally
- [ ] Code formatted with Black
- [ ] No Ruff linting errors
- [ ] ADR created/updated in `docs/docs/changes/` (if applicable)
- [ ] Type hints added to new functions
- [ ] Docstrings added to public functions
- [ ] README updated (if user-facing changes)

## Dependencies

### Adding Dependencies

```bash
# Add new dependency
uv add rich

# Add dev dependency
uv add --dev pytest

# Update lock file
uv lock
```

### Dependency Guidelines

- Prefer established, maintained libraries
- Check license compatibility
- Document why dependency is needed
- Pin versions in pyproject.toml

## Security

- Never commit secrets or tokens
- Use environment variables for configuration
- Validate all user input
- Follow Python security best practices

## Performance

- Minimize blocking I/O operations
- Use async/await for network calls
- Cache expensive computations
- Profile before optimizing

## Accessibility

- Support screen readers (avoid excessive line clearing)
- Provide text-only mode option
- Use clear, descriptive messages
- Support keyboard-only navigation

## Contact

**Maintainer**: Sri Aradhyula <sraradhy@cisco.com>
**Team**: Platform Engineering Team

For questions:
- Check `docs/docs/changes/` for ADRs
- Review existing issues/PRs
- Contact maintainer

---

**Remember**:
- ‚úÖ Use conventional commits
- ‚úÖ Always sign off with DCO (`-s`)
- ‚úÖ Write ADRs in `docs/docs/changes/`
- ‚úÖ Test before committing
